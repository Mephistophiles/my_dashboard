# Формулы и алгоритмы расчета прогнозов

## 1. Анализ погоды для фотографии

### Общая оценка условий (0-10 баллов)

**Формула:**
```
score = (visibility_score + cloud_score + wind_score + precipitation_score) / 4
```

**Компоненты:**
- **Видимость (visibility_score):** 0-10 баллов
  - 10 км+ = 10 баллов
  - 5-10 км = 7 баллов  
  - 2-5 км = 4 балла
  - <2 км = 1 балл

- **Облачность (cloud_score):** 0-10 баллов
  - 0-20% = 10 баллов (ясно)
  - 20-40% = 8 баллов (малооблачно)
  - 40-60% = 6 баллов (переменная облачность)
  - 60-80% = 4 балла (облачно)
  - 80-100% = 2 балла (пасмурно)

- **Ветер (wind_score):** 0-10 баллов
  - 0-3 м/с = 10 баллов (штиль/слабый)
  - 3-7 м/с = 7 баллов (умеренный)
  - 7-12 м/с = 4 балла (сильный)
  - >12 м/с = 1 балл (очень сильный)

- **Осадки (precipitation_score):** 0-10 баллов
  - 0-10% = 10 баллов
  - 10-30% = 7 баллов
  - 30-60% = 4 балла
  - >60% = 1 балл

### Лучшие часы для съемки

Час считается подходящим если:
- Облачность < 60%
- Ветер < 10 м/с
- Видимость > 5 км
- Вероятность осадков < 30%

## 2. Анализ условий для астрофотографии

### Критерии пригодности

**Условие подходит для астрофотографии если:**
- Средняя облачность < 30%
- Ветер < 8 м/с
- Видимость > 8 км

### Лучшие часы для астрофотографии

Ночные часы (22:00 - 05:00) с дополнительными условиями:
- Облачность < 20%
- Ветер < 5 м/с
- Видимость > 10 км

## 3. Расчет золотого часа

### Формулы расчета времени

**Золотой час утром:**
- Начало: Восход - 1 час
- Конец: Восход + 1 час

**Золотой час вечером:**
- Начало: Закат - 1 час  
- Конец: Закат + 1 час

**Синий час утром:**
- Начало: Восход - 30 минут
- Конец: Восход

**Синий час вечером:**
- Начало: Закат
- Конец: Закат + 30 минут

### Используемые библиотеки
- `sunrise` crate для расчета времени восхода/заката
- Координаты: широта/долгота из конфигурации

## 4. Прогноз северных сияний

### Вероятность видимости (0-100%)

**Формула:**
```
probability = kp_factor + speed_factor + density_factor
```

**Компоненты:**

1. **Kp индекс (kp_factor):** 0-60%
   ```
   kp_factor = (kp_index / 9.0) * 0.6
   ```

2. **Скорость солнечного ветра (speed_factor):** 0-30%
   - >600 км/с = 30%
   - 500-600 км/с = 20%
   - 400-500 км/с = 10%
   - <400 км/с = 0%

3. **Плотность солнечного ветра (density_factor):** 0-10%
   - >10 частиц/см³ = 10%
   - 5-10 частиц/см³ = 5%
   - <5 частиц/см³ = 0%

### Активность северных сияний (0-10)

**Формула на основе Kp индекса:**
```
if kp_index >= 5.0:
    activity = 8.0 + (kp_index - 5.0) * 0.4
else if kp_index >= 3.0:
    activity = 4.0 + (kp_index - 3.0) * 2.0
else:
    activity = kp_index * 1.33
```

### Уровни интенсивности

- **Очень высокая:** >80%
- **Высокая:** 60-80%
- **Умеренная:** 40-60%
- **Низкая:** 20-40%
- **Минимальная:** <20%

## 5. Вариации температуры в прогнозе

### Алгоритм генерации реалистичных вариаций

**Базовая температура:** Текущая температура из API

**Суточные вариации:**
- 6-8 часов: -2°C (утро прохладнее)
- 9-11 часов: -1°C (начало дня)
- 12-16 часов: 0°C (день - базовая температура)
- 17-19 часов: -1°C (вечер)
- 20-22 часа: -2°C (поздний вечер)
- 23-5 часов: -3°C (ночь холоднее)

**Случайные вариации:**
- Температура: ±1°C
- Влажность: ±5%
- Ветер: ±1 м/с
- Облачность: ±5%

**Ограничения:**
- Температура: -20°C до +50°C
- Влажность: 0-100%
- Ветер: ≥0 м/с
- Облачность: 0-100%

## 6. Источники данных

### Погода
- **API:** OpenWeatherMap Current Weather
- **URL:** `https://api.openweathermap.org/data/2.5/weather`
- **Параметры:** lat, lon, units=metric, appid

### Солнечный ветер
- **API:** NOAA SWEPAM (ACE satellite)
- **URL:** `https://services.swpc.noaa.gov/json/ace/swepam/ace_swepam_1h.json`
- **Данные:** скорость, плотность, температура

### Геомагнитные данные
- **API:** NOAA Planetary K Index
- **URL:** `https://services.swpc.noaa.gov/json/planetary_k_index_1m.json`
- **Данные:** Kp индекс

### Координаты городов
- **API:** OpenWeatherMap Geocoding
- **URL:** `http://api.openweathermap.org/geo/1.0/direct`
- **Параметры:** q (название города), limit=1, appid 